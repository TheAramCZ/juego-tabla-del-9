<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de la Tabla del 9</title>
    
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- === NUEVAS L√çNEAS PARA LA PWA === -->
    
    <!-- 1. Enlace al Manifiesto -->
    <link rel="manifest" href="manifest.json">
    
    <!-- 2. Color de la barra de estado (para m√≥viles) -->
    <meta name="theme-color" content="#4299e1"> <!-- Un tono de azul -->
    
    <!-- === FIN DE L√çNEAS PWA === -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .option-btn.correct {
            background-color: #22c55e; 
        }
        .option-btn.incorrect {
            background-color: #ef4444;
            opacity: 0.7;
        }
        .option-btn:disabled {
            opacity: 0.8;
        }
    </style>
</head>
<body class="bg-blue-50 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white w-full max-w-lg p-6 sm:p-10 rounded-2xl shadow-xl border border-blue-100">
        
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-blue-800 mb-2">
            Desaf√≠o de la Tabla del 9
        </h1>
        <div class="text-center text-lg text-gray-600 mb-6" id="score-display">
            Puntaje: 0 / 0
        </div>

        <div class="bg-blue-100 h-32 flex items-center justify-center rounded-xl mb-8 p-4">
            <span id="question-text" class="text-4xl sm:text-6xl font-bold text-blue-900">
                9 x 5 = ?
            </span>
        </div>

        <div id="options-container" class="grid grid-cols-2 gap-4 mb-6">
            <!-- Botones generados por JS -->
        </div>

        <div class="h-10 text-center mb-4">
            <span id="message-text" class="text-2xl font-semibold transition-all">
                &nbsp;
            </span>
        </div>

        <button id="next-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg text-xl transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300 shadow-md">
            Siguiente
        </button>

    </div>

    <script>
        // --- Referencias a los elementos del DOM ---
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const scoreDisplay = document.getElementById('score-display');
        const messageText = document.getElementById('message-text');
        const nextButton = document.getElementById('next-button');

        // --- Estado del juego (sin cambios) ---
        let score = 0;
        let questionsAsked = 0;
        let multipliers = [];
        let currentMultiplier = 0;
        let correctAnswer = 0;
        let gameActive = true;
        const TOTAL_QUESTIONS = 10;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            score = 0;
            questionsAsked = 0;
            gameActive = true;
            multipliers = Array.from({ length: TOTAL_QUESTIONS }, (_, i) => i + 1);
            shuffleArray(multipliers);
            nextButton.textContent = 'Siguiente';
            nextButton.disabled = true;
            generateQuestion();
            updateScoreDisplay();
        }

        function generateQuestion() {
            messageText.textContent = '\u00A0';
            messageText.className = 'text-2xl font-semibold transition-all';
            optionsContainer.innerHTML = '';
            nextButton.disabled = true;
            gameActive = true;

            if (multipliers.length === 0) {
                endGame();
                return;
            }

            currentMultiplier = multipliers.pop();
            correctAnswer = 9 * currentMultiplier;
            questionsAsked++;
            questionText.textContent = `9 x ${currentMultiplier} = ?`;

            const options = generateOptions(correctAnswer);
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'option-btn bg-blue-500 hover:bg-blue-600 text-white font-bold text-2xl py-6 rounded-lg transition-all transform hover:scale-105 shadow-sm';
                button.onclick = () => checkAnswer(option, button);
                optionsContainer.appendChild(button);
            });
            
            updateScoreDisplay();
        }

        function generateOptions(correctAnswer) {
            const options = new Set();
            options.add(correctAnswer);
            while (options.size < 4) {
                let decoyMultiplier = Math.floor(Math.random() * TOTAL_QUESTIONS) + 1;
                let decoyAnswer = 9 * decoyMultiplier;
                if (decoyAnswer !== correctAnswer) {
                    options.add(decoyAnswer);
                } else {
                    let randomDecoy = correctAnswer + (Math.random() > 0.5 ? 1 : -1) * (Math.floor(Math.random() * 3) + 1);
                    if (randomDecoy > 0 && randomDecoy !== correctAnswer) {
                         options.add(randomDecoy);
                    }
                }
            }
            const shuffledOptions = Array.from(options);
            shuffleArray(shuffledOptions);
            return shuffledOptions;
        }

        function checkAnswer(selectedOption, selectedButton) {
            if (!gameActive) return;
            gameActive = false;
            nextButton.disabled = false;
            const allButtons = optionsContainer.querySelectorAll('.option-btn');
            
            if (selectedOption === correctAnswer) {
                score++;
                messageText.textContent = '¬°Correcto! üéâ';
                messageText.className += ' text-green-600';
                selectedButton.className += ' correct';
            } else {
                messageText.textContent = `¬°Casi! Era ${correctAnswer} üò¢`;
                messageText.className += ' text-red-600';
                selectedButton.className += ' incorrect';
                allButtons.forEach(btn => {
                    if (parseInt(btn.textContent) === correctAnswer) {
                        btn.className += ' correct';
                    }
                });
            }

            allButtons.forEach(btn => {
                btn.disabled = true;
                if (!btn.classList.contains('correct') && !btn.classList.contains('incorrect')) {
                    btn.style.opacity = '0.6';
                }
            });
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `Puntaje: ${score} / ${questionsAsked}`;
        }

        function endGame() {
            gameActive = false;
            questionText.textContent = '¬°Juego Terminado!';
            optionsContainer.innerHTML = '';
            
            let finalMessage = `Tu puntaje final es ${score} de ${TOTAL_QUESTIONS}. `;
            if (score === TOTAL_QUESTIONS) {
                finalMessage += '¬°Perfecto! ü§©';
                messageText.className = 'text-2xl font-semibold text-green-600';
            } else if (score >= 7) {
                finalMessage += '¬°Muy bien! üëç';
                messageText.className = 'text-2xl font-semibold text-blue-600';
            } else {
                finalMessage += '¬°Sigue practicando! üí™';
                messageText.className = 'text-2xl font-semibold text-gray-700';
            }
            messageText.textContent = finalMessage;
            
            nextButton.textContent = 'Volver a Jugar';
            nextButton.disabled = false;
        }

        nextButton.addEventListener('click', () => {
            if (questionsAsked === TOTAL_QUESTIONS && !gameActive) {
                startGame();
            } else {
                generateQuestion();
            }
        });

        document.addEventListener('DOMContentLoaded', startGame);
        
        // --- NUEVO SCRIPT PARA REGISTRAR EL SERVICE WORKER ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado con √©xito:', registration);
                    })
                    .catch(error => {
                        console.log('Error al registrar el Service Worker:', error);
                    });
            });
        }

    </script>
</body>
</html>
